(()=>{"use strict";function e(e,t){return e<1?`${e} blocked search results`:`${e} blocked search results. Click to ${t?"hide":"show"} them again`}class t{constructor(e,t,n){this.blockedUrlsDict=e,this.updateCallback=n,this.countUpdates={},this.lifetimeBlocks={w:0,i:0,v:0,n:0},this.lifetimeBlocks=t,this.debouncedBatchUpdate=this.debounce((()=>this.batchUpdateCounts()),1e3),window.addEventListener("beforeunload",(()=>this.batchUpdateCounts()))}incrementCount(e,t){this.countUpdates[e]||(this.countUpdates[e]={w:0,i:0,v:0,n:0}),this.countUpdates[e][t]++,this.debouncedBatchUpdate()}batchUpdateCounts(){return e=this,t=void 0,o=function*(){if(0===Object.keys(this.countUpdates).length)return;const e=Object.assign({},this.blockedUrlsDict.blockedUrlData),t=Object.assign({},this.lifetimeBlocks);for(const[n,o]of Object.entries(this.countUpdates)){e[n]||(e[n]={w:0,i:0,v:0,n:0});for(const s of["w","i","v","n"])e[n][s]+=o[s],t[s]+=o[s]}try{yield chrome.storage.local.set({blockedUrlData:e,lifetimeTotalBlocks:t}),this.updateCallback(e),this.countUpdates={}}catch(e){console.error("Failed to update blocked URL data:",e)}},new((n=void 0)||(n=Promise))((function(s,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function c(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}l((o=o.apply(e,t||[])).next())}));var e,t,n,o}debounce(e,t){let n;return(...o)=>{clearTimeout(n),n=setTimeout((()=>e(...o)),t)}}}class n{get blockedCount(){return this._blockedCount}get resultsAreHidden(){return this._resultsAreHidden}setBlockedElementsVisibility(e){this._resultsAreHidden=e,this.updateBlockedElementsVisibility()}constructor(e,n,o){this.processedResults=new Set,this._blockedCount=0,this._resultsAreHidden=!1,this.isExtensionOn=!0,this.blockedUrlsDict=e,this.isExtensionOn=n,this.addDocumentHead(),this.addEventListeners(),this.updateManager=new t(e,o,this.updatedBlockedCallback.bind(this)),this.searchResultsContainer=document.body}getSearchElement(){return new Promise((e=>{new MutationObserver(((t,n)=>{const o=document.querySelector("#search");o&&(this.searchResultsContainer=o,n.disconnect(),e())})).observe(document.body,{childList:!0,subtree:!0})}))}addEventListeners(){document.addEventListener("DOMContentLoaded",(()=>{!function(t,n,o,s){let i=document.querySelector(".fM33ce"),r=document.createElement("div");if(!i&&(i=document.querySelector("#appbar"),r.style.marginBottom="5px",!i))return;r.id="extension-button-search-bar",r.title=e(o,t()),r.className="XDyW0e";const c=document.createElement("img");c.src=chrome.runtime.getURL("logoApp.png"),c.className="logo-image";const l=document.createElement("div");l.className="blocked-count-overlay",l.textContent=o.toString(),r=s?function(s){return s.addEventListener("click",(()=>{n(!t()),s.title=e(o,t())})),s}(r):function(e){return e.title="Search Sanitizer is currently turned off. Click to turn back on",e.style.opacity="0.4",e.addEventListener("click",(()=>{chrome.storage.local.set({extensionOnOff:!0},(()=>{window.location.reload()}))})),e}(r),r.appendChild(c),r.appendChild(l);const a=i.querySelector(".dRYYxd");a?a.insertAdjacentElement("afterend",r):i.appendChild(r),function(){const e=document.createElement("style");e.textContent="\n  .extension-button:hover { opacity: 0.4 !important; }\n  .extension-button:active { transform: scale(0.99) !important; }\n .blocked-count-overlay {\n  position: absolute;\n  background-color: #8e8280;\n  color: white;\n  padding-right: 2px;\n  padding-left: 2px;\n  font-size: 12px;\n  border-radius: 8px;\n  font-weight: bold;\n  min-width: 26px;\n  max-width: 60px;\n  height: 15px;\n  top: 1px;\n  right: -8px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n  user-select: none;\n}\n#extension-button-search-bar{\n  position: relative;\n  user-select: none;\n}\n.logo-image{\n  width: 22px;\n  height: 22px;\n}\n",document.head.appendChild(e)}()}((()=>this.resultsAreHidden),(e=>this.setBlockedElementsVisibility(e)),this.blockedCount,this.isExtensionOn)}))}addDocumentHead(){const e=document.createElement("style");e.id="Site Blocker Custom Styles",e.textContent='\n        /* Display Styles */\n        [card-show="false"] { display: none !important; }\n        /* Card Color Styles */\n        [card-relevant="true"] {opacity: 0.3 !important}\n      ',document.head.appendChild(e)}incrementBlockCount(e,t){this._blockedCount++,this.updateManager.incrementCount(e,t)}updatedBlockedCallback(e){this.blockedUrlsDict.blockedUrlData=e,chrome.runtime.sendMessage({type:"updateBadge",count:this._blockedCount})}markElementAsBlocked(t){!function(t){const n=document.querySelector("#extension-button-search-bar");n&&(n.title=e(t,!1));const o=document.querySelector(".blocked-count-overlay");o&&(o.textContent=t.toString())}(this.blockedCount),t.setAttribute("card-show",this.resultsAreHidden.toString()),t.setAttribute("card-relevant","true")}updateBlockedElementsVisibility(){document.querySelectorAll("[card-show]").forEach((e=>{e instanceof HTMLElement&&e.setAttribute("card-show",this._resultsAreHidden.toString())}))}isPatternUrl(e,t,n){try{if(!n)return!1;const o=[n=this.removeTrailingSlash(n.toLowerCase()),`www.${n}`,`https://${n}`,`https://www.${n}`,`http://${n}`,`http://www.${n}`],s=[t,e.origin.toLowerCase(),e.host.toLowerCase(),e.hostname.toLowerCase(),this.removeTrailingSlash(e.href.toLowerCase())];for(const e of s)for(const t of o)if(e===t)return!0;return!1}catch(e){return console.error("Invalid URL"),!1}}removeTrailingSlash(e){return e.endsWith("/")?e.slice(0,-1):e}isPatternWildcard(e,t){e=e.toLowerCase();const n=(t=t.toLowerCase()).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\\\*/g,".*");return new RegExp(`^${n}$`).test(e)}shouldUrlBeBlocked(e,t,n){const o=new URL(e);for(const s of Object.keys(this.blockedUrlsDict.blockedUrlData)){if(this.isPatternUrl(o,e,s))return console.log(`Blocked URL: ${e} url pattern: ${s} from ${n}`),this.incrementBlockCount(s,t),!0;if(this.isPatternWildcard(e,s))return this.incrementBlockCount(s,t),console.log(`Blocked URL: ${o} matched pattern: ${s} from ${n}`),!0}return!1}isElementVisible(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}processSearchResultsForBlocking(e,t,n,o){const s=t.querySelectorAll(e);null==s||s.forEach((e=>{this.processedResults.has(e)||(this.processedResults.add(e),e.setAttribute("data-processed","true"),(this.checkLinksForBlockedUrls(e,n,o,"regular")||this.checkCitesForBlockedUrls(e,n,o,"regular"))&&this.markElementAsBlocked(e))}))}checkLinksForBlockedUrls(e,t,n,o){const s=e.querySelectorAll("a");for(const e of s)if(e.href&&this.shouldUrlBeBlocked(e.href,n,o)&&(t||this.isElementVisible(e)))return!0;return!1}checkCitesForBlockedUrls(e,t,n,o){var s;const i=e.querySelectorAll("cite");for(const e of i){let i=null===(s=e.textContent)||void 0===s?void 0:s.split(" ")[0];if(console.log(i),i&&(/^https?:\/\//i.test(i)||(i="https://"+i),this.shouldUrlBeBlocked(i,n,o)&&(t||this.isElementVisible(e))))return!0}return!1}processImagesForBlocking(){this.processSearchResultsForBlocking(".ivg-i:not([data-processed])",this.searchResultsContainer,!0,"i")}processTopAddsForBlocking(){this.processSearchResultsForBlocking(".mnr-c.pla-unit:not([data-processed])",document.body,!1,"i")}processNewsForBlocking(){this.processSearchResultsForBlocking(".SoaBEf:not([data-processed])",this.searchResultsContainer,!1,"n")}processVideosForBlocking(){this.processSearchResultsForBlocking(".g:not([data-processed])",this.searchResultsContainer,!1,"v")}processRegularForBlocking(){this.processSearchResultsForBlocking(".g:not([data-processed]):not([data-initq]:not(.ivg-i):not(.related-question-pair)",this.searchResultsContainer,!1,"w")}}function o(e){return t=this,o=arguments,i=function*({extensionIsOn:e,urlsDict:t,lifeTimeBlocks:o}){const s=new n(t,e,o);e&&(yield s.getSearchElement(),s.processRegularForBlocking(),s.processImagesForBlocking(),s.processTopAddsForBlocking(),s.searchResultsContainer&&new MutationObserver((()=>{s.processRegularForBlocking(),s.processImagesForBlocking(),s.processTopAddsForBlocking(),setTimeout((()=>function(){var e;const t=null===(e=s.searchResultsContainer)||void 0===e?void 0:e.querySelectorAll("[data-initq]");null==t||t.forEach((e=>{e.querySelectorAll(".related-question-pair:not([data-processed])").forEach((e=>{s.processedResults.has(e)||(s.processedResults.add(e),e.setAttribute("data-processed","true"),(s.checkLinksForBlockedUrls(e,!0,"w","related Q")||s.checkCitesForBlockedUrls(e,!0,"w","related Q"))&&(console.log("block ",e),s.markElementAsBlocked(e)))}))}))}()),500)})).observe(s.searchResultsContainer,{childList:!0,subtree:!0}))},new((s=void 0)||(s=Promise))((function(e,n){function r(e){try{l(i.next(e))}catch(e){n(e)}}function c(e){try{l(i.throw(e))}catch(e){n(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(r,c)}l((i=i.apply(t,o||[])).next())}));var t,o,s,i}var s=function(e,t,n,o){return new(n||(n=Promise))((function(s,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function c(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}l((o=o.apply(e,t||[])).next())}))};!function(){s(this,void 0,void 0,(function*(){const e=yield function(){return s(this,void 0,void 0,(function*(){return(yield chrome.storage.local.get("extensionOnOff")).extensionOnOff}))}(),t=yield function(){return s(this,void 0,void 0,(function*(){return{blockedUrlData:(yield chrome.storage.local.get("blockedUrlData")).blockedUrlData||{}}}))}(),i=yield function(){return s(this,void 0,void 0,(function*(){return(yield chrome.storage.local.get("lifetimeTotalBlocks")).lifetimeTotalBlocks}))}();t.blockedUrlData&&function(e){var t,s;const i=new URL(window.location.href).searchParams,r=null!==(t=i.get("tbm"))&&void 0!==t?t:"",c=null!==(s=i.get("udm"))&&void 0!==s?s:"";r.includes("bks")||(r.includes("vid")?function(e){var t,o,s,i;t=this,o=arguments,i=function*({extensionIsOn:e,urlsDict:t,lifeTimeBlocks:o}){const s=new n(t,e,o);e&&(yield s.getSearchElement(),s.processVideosForBlocking(),new MutationObserver((()=>{s.processVideosForBlocking()})).observe(s.searchResultsContainer,{childList:!0,subtree:!0}))},new((s=void 0)||(s=Promise))((function(e,n){function r(e){try{l(i.next(e))}catch(e){n(e)}}function c(e){try{l(i.throw(e))}catch(e){n(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(r,c)}l((i=i.apply(t,o||[])).next())}))}(e):r.includes("nws")?function(e){var t,o,s,i;t=this,o=arguments,i=function*({extensionIsOn:e,urlsDict:t,lifeTimeBlocks:o}){const s=new n(t,e,o);e&&(yield s.getSearchElement(),s.processNewsForBlocking(),s.searchResultsContainer&&new MutationObserver((()=>{s.processNewsForBlocking()})).observe(s.searchResultsContainer,{childList:!0,subtree:!0}))},new((s=void 0)||(s=Promise))((function(e,n){function r(e){try{l(i.next(e))}catch(e){n(e)}}function c(e){try{l(i.throw(e))}catch(e){n(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(r,c)}l((i=i.apply(t,o||[])).next())}))}(e):c.includes("2")?function(e){var t,o,s,i;t=this,o=arguments,i=function*({extensionIsOn:e,urlsDict:t,lifeTimeBlocks:o}){const s=new n(t,e,o);e&&(yield s.getSearchElement(),s.processImagesForBlocking(),s.processTopAddsForBlocking(),s.searchResultsContainer&&new MutationObserver((()=>{s.processImagesForBlocking(),s.processTopAddsForBlocking()})).observe(s.searchResultsContainer,{childList:!0,subtree:!0}))},new((s=void 0)||(s=Promise))((function(e,n){function r(e){try{l(i.next(e))}catch(e){n(e)}}function c(e){try{l(i.throw(e))}catch(e){n(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(r,c)}l((i=i.apply(t,o||[])).next())}))}(e):o(e))}({extensionIsOn:e,urlsDict:t,lifeTimeBlocks:i})}))}()})();